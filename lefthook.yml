---
pre-commit:
  commands:
    dprint-fmt:
      run: |
        files=$(echo "{staged_files}" | tr ' ' '\n' | grep -E '(Dockerfile|\.json|\.md)$' || true)
        if [ -n "$files" ]; then
          echo "$files" # フォーマット対象のファイル名出力(go fmt等では出力されるが、dprintでは出力されないため)
          echo "$files" | xargs -r dprint fmt
        fi
      stage_fixed: true

pre-push:
  commands:
    golangci-lint:
      # モノレポ構造に対応したlint実行
      run: |
        # go.modファイルを持つディレクトリを検索
        modules=$(find ./services ./pkg -name "go.mod" 2>/dev/null | xargs dirname | sort)

        if [ -z "$modules" ]; then
          echo "go.modファイルが見つかりませんでした。"
          exit 0
        fi

        # 各モジュールでgolangci-lintを実行
        for module in $modules; do
          echo "Running golangci-lint in $module"
          (cd "$module" && golangci-lint run ./... --fix)
        done
